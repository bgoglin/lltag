.\" Process this file with
.\" groff -man -Tascii foo.1
.\"
.TH LLTAG 1 "SEPTEMBER 2006"





.SH NAME
lltag - tag mp3/ogg/flac music files automagically




.SH SYNOPSIS
.B lltag
.RB [ -C ]
.RB [ "-F <format>" ]
.RB [ -G ]
.RB [ -p ]
.RB [ "-a <artist>" ]
.RB [ "-t <title>" ]
.RB [ "-A <album>" ]
.RB [ "-n <number>" ]
.RB [ "-g <genre>" ]
.RB [ "-d <date>" ]
.RB [ "-c <comment>" ]
.RB [ "--tag <TAG=value>" ]
.RB [ --spaces ]
.RB [ --maj ]
.RB [ "--sep\ <s1|s2|...>" ]
.RB [ "--regexp <regexp>" ]
.RB [ --mp3/--ogg/--flac ]
.RB [ "--type <type>" ]
.RB [ --clear ]
.RB [ --append ]
.RB [ --no-tagging ]
.RB [ "--rename <format>" ]
.RB [ --rename-ext ]
.RB [ --rename-min ]
.RB [ "--rename-sep <sep>" ]
.RB [ "--rename-regexp <regexp>" ]
.RB [ --dry-run ]
.RB [ --yes ]
.RB [ --ask ]
.RB [ "--cddb-query <query>" ]
.RB [ "--cddb-server <server[:port]>" ]
.RB [ -R ]
.RB [ -v ]
.RB [ "--config <file>" ]
.RB [ "--gencfg <file>" ]
.RB [ -S ]
.RB [ "--show-tags <tags>" ]
.RB [ -L ]
.RB [ -V ]
.RB [ -h ]
.\"




.SH DESCRIPTION
.B lltag
is a command-line tool to automagically set tags of MP3, OGG or FLAC files.
It parses the filenames according to different formats to get the tags.
The formats may be either given by the user or guessed by lltag from
its internal database.

When called with the
.B -F
option (once or multiple times), it will first try the user-specified formats.

Internal formats will be tried later if the
.B -G
option was passed.

.B mp3info
is used to tag
.B MP3
files while
.B vorbiscomment
is used for
.B OGG
files, and
.B metaflac
is used for
.B FLAC
files.

When called with
.B --rename
the target file will also be renamed.




.SH OPTIONS

.TP
.BI "-A, --album" " <album>"
Set the default value of the \fIALBUM\fR tag.

.TP
.BI "-a, --artist" " <artist>"
Set the default value of the \fIARTIST\fR tag.

.TP
.BI "--append"
Force appending of ogg/flac tags
(instead of replacing existing tags).

Since mp3 files may only get one tag of each type, appending
does nothing, the first occurence only is stored.

.TP
.B --ask
Always ask confirmation to the user before using a user-specified
parser. By default, all actions require confirmation, except when
a matching user-specified format is found.
See
.B PARSING MENU
in
.B INTERACTIVE MENUS
below for details.

.TP
.BI "-C, --cddb"
Try to find tags in the CDDB online database before trying to parse filenames.
The queries are sent using the HTTP interface, which means a HTTP proxy might
be used when required.

.TP
.BI "--cddb-query" " <keywords>"
.TP
.BI "--cddb-query" " <cat>/<id>"
Automatically search for CD matching <keywords> or matching category <cat>
and id <id>
as if the user passed
.B --cddb
and entered the query interactively in the module.

.TP
.BI "--cddb-server" " <server[:port]>"
Change the CDDB server, and eventually its port.
The default is
.BR www.freedb.org:80 .
If a HTTP proxy is required to access the internet,
the environment variable
.B HTTP_PROXY
may be used (set to something like "http://my.proxy.com").

.TP
.BI "-c, --comment" " <comment>"
Set the default value of the \fICOMMENT\fR tag.

.TP
.B --clear
Force clearing of all tags before tagging
(instead of replacing existing tags).

.TP
.BI --config " <file>"
Parse additional configuration file.
See
.B CONFIGURATION FILES
below for details.

.TP
.BI "-d, --date" " <date>"
Set the default value of the \fIDATE\fR tag.
Note that mp3 tags may only store 4 characters (for a year).

.TP
.B --dry-run
Do not really tag files, just show what would have been done.

.TP
.BI "-F, --format" " <format>"
Add the specified format string to the list of user-supplied formats.
Might be used several times to try different formats.
See
.B FORMAT
below for details.

.TP
.B --flac
Tag all files as FLAC files, using \fBmetaflac\fR.

.TP
.B "-G, --guess"
Guess format using the internal database if no user-specified format
worked (default behavior).

.TP
.BI "-g, --genre" " <genre>"
Set the default value of the \fIGENRE\fR tag.

.TP
.BI --gencfg " <file>"
Generate configuration file.
See
.B CONFIGURATION FILES
below for details.

.TP
.B "-h, --help"
Print a usage message and exit.

.TP
.B "-L, --list"
List internal formats.

.TP
.B --maj
Upcase the first letter of each word in tags.

.TP
.B --mp3
Tag all files as MP3 files, using \fBmp3info\fR.

.TP
.BI "-n, --number" " <number>"
Set the default value of the \fINUMBER\fR tag.

.TP
.B --no-tagging
Do not actually tag files. This might be used to rename files
without tagging.

.TP
.B --ogg
Tag all files as OGG files, using \fBvorbiscomment\fR.

.TP
.B "-p, --nopath"
Do not consider the path of files when matching.

.TP
.B "-R, --recursive"
Recursively search for files in subdirectories.

.TP
.BI --regexp " <[tag,tag:]s/from/to/>"
Replace \fIfrom\fR with \fIto\fR in tags before tagging.
If several tags (comma-separated) prefix the regexp, replacement is
only applied to the corresponding fields.
This option might be used multiple times to specify multiple replacing.

.TP
.BI --rename " <format>"
After tagging, rename the file according to the format.
The format is filled using the first occurence of each tag that was
used to tag the file right before.
It means that an old existing tag may be used if no new one replaced
it and
.B --clear
was not passed.

By default, confirmation is asked before tagging.
See
.B RENAMING MENU
in
.B INTERACTIVE MENUS
below for details.

.TP
.B --rename-ext
Assume that the file extension is provided by the rename format
instead of automatically adding the extension corresponding to
the file type.

.TP
.B --rename-min
Lowcase all tags before renaming.

.TP
.BI --rename-regexp " <[tag,tag:]s/from/to/>"
Replace \fIfrom\fR with \fIto\fR in tags before renaming.
If several tags (comma-separated) prefix the regexp, replacement is
only applied to the corresponding fields.
This option might be used multiple times to specify multiple replacing.

.TP
.BI --rename-sep " <sep>"
Replace spaces with sep when renaming.
See
.B --rename-regexp
for a more general replace feature.

.TP
.B -S
Instead of tagging, lltag shows the tags that are currently set in
files.
See
.B --show-tags
to show only some tags.

.TP
.BI --sep " <string|string>"
Replace the specified characters or strings with space in tags.
They have to be |-separated.
See
.B --regexp
for a more general replace feature.

.TP
.BI --show-tags " <tag1,tag2,...>"
Instead of tagging, lltag shows tags that are currently set in files.
The argument is a comma separated list of tag types
.RI ( artist ", " title ", " album ", " number ", "
.IR genre ", " date ", " comment " or " all ).
See also
.B -B
to show all tags.

.TP
.B --spaces
Allow multiple or no space instead of only one when matching.
Also allow spaces limiting path elements.

.TP
.BI "-t, --title" " <title>"
Set the default value of the \fITITLE\fR tag.

.TP
.BI "--tag" " <TAG=value>"
Add an additional tag.
Might be used several times.
Note that mp3 tags do not support whatever
.IR TAG .

.TP
.BI "--type" " <type>"
Tag all files as
.B <type>
files.

.TP
.B "-v, --verbose"
Show verbose messages.

.TP
.B "-V, --version"
Show the version.

.TP
.B --yes
Always accept tagging without asking the user.
By default user-specified format matching is accepted
while guess format matching is asked for confirmation.

Also always accept renaming without asking the user.




.SH INTERACTIVE MENUS
When not running with
.BI --yes ,
the user has to tells lltag what to do.
Files are processed one after the other, with the following steps:
.TP
.B *
If the
.B preferred
parser exists, try to apply it.
.TP
.B *
If failed, if 
.B --cddb
was passed, trying a CDDB query.
.TP
.B *
If failed, try the user-provided formats, if any.
.TP
.B *
If failed, if no user-format were passed, or if
.B -G
was passed, try the internal formats.
.TP
.B *
Then we have a list of tags to apply, we may apply them, edit them,
or go back to a CDDB query or trying to parse the filename again.
.TP
.B *
Then, if
.B --rename
was passed, the file is renamed.

We now describe all interactive menus.



.SS MAIN MENU
Once some tags have been obtained by either CDDB, parsing or the default
values on the command line, the main menu opens to either change the tags
or apply them:
.TP
.B y
Yes, use these tags (default)
.TP
.B a
Always yes, stop asking for a confirmation
.TP
.B P
Try to parse the file, see
.B PARSING MENU
.TP
.B C
Query CDDB, see
.B CDDB MENUS
.TP
.B E
Edit values, see
.B EDITING MENU
.TP
.B D
Only use default values, forget about CDDB or parsed tags
.TP
.B q
Skip this file
.TP
.B Q
Quit without tagging anything anymore



.SS CDDB MENUS
When the CDDB opens for the first time, the user must enter a query
to choose a CD in the online database.
.TP
.B <space-separated keywords>
CDDB query for CD matching the keywords.
Search in all CD categories within fields artist and title by default.
If
.B cats=foo+bar
is added, search in CD categories foo and bar only.
If
.B fields=all
is added, search keywords in all fields.
If
.B fields=foo+bar
is added, search keywords in fields foo and bar.
.TP
.B <category>/<hexadecinal id>
CDDB query for CD matching category and id
.TP
.B q
Quit CDDB query, see
.B MAIN MENU

.P
Once keywords have been passed as a query to CDDB, a list of matching
CD titles will be displayed. The user then needs to choose one:
.TP
.B <index>
Choose a CD in the current keywords query results list
.TP
.B v
View the list of CD matching the keywords
.TP
.B k
Start again CDDB query with different keywords
.TP
.B q
Quit CDDB query, see
.B MAIN MENU

.P
Once a CD have been chosen, the user needs to choose a track
.TP
.B <index>
Choose a track of the current CD
.TP
.B <index> a
Choose a track and do not ask for confirmation anymore
.TP
.B a
Use default track and do not ask for confirmation anymore
.TP
.B E
Edit current CD common tags, see
.B EDITING MENU
.TP
.B v
View the list of CD matching the keywords
.TP
.B c
Change the CD chosen in keywords query results list
.TP
.B k
Start again CDDB query with different keywords
.TP
.B q
Quit CDDB query, see
.B MAIN MENU

.P
Note that entering the CDDB menus again will go back to the previous
CD instead of asking the user to query again, so that an entire CD
may be tagged easily.



.SS PARSING MENU
When
.B --ask
is passed or when guessing, each matching will lead to
a confirmation message before tagging.
Available behaviors are:
.TP
.B y
Tag current file with current format. This is the default.
.TP
.B u
Tag current file with current format.
Then use current format for all remaining matching files.
When a non-matching file is reached, stop using this
preferred format.
.TP
.B a
Tag current file with current format.
Then, never asking for a confirmation anymore.
.TP
.B n
Don't tag current file with this format.
Try the next matching format on the current file.
.TP
.B p
When matching is done through combination of a path parser
and a basename parser, keep the basename parser and try the
next path parser on the current file.
.TP
.B q
Skip the current file, don't tag it at all.



.SS EDITING MENU
It is possible to edit tags, either before tagging or file, or before
choosing a track in a CD obtained by CDDB.
The current value of all regular fields is shown and may be modified
by entering another value, deleted by entering
.BR <DELETE> ,
or cleared.

The behavior depends on the installed readline library.
If it is smart, the current value may be edited inline and an
history is available.
If not, pressing
.I <enter>
will keep the current value while
.I CLEAR
will empty it.

Each field may be selected for edition by pressing its corresponding
letter in the format (see \fBFORMAT\fR).
Editing ends by tagging (if \fIE\fR is pressed)
or canceling and return to confirmation menu (if \fIC\fR is pressed).

The other options are:
.TP
.B V
View the current values of tags
.TP
.B y
End edition, save changes, and return to previous menu
.TP
.B q
Cancel edition, forget about changes, and return to previous menu



.SS RENAMING MENU
By default, before renaming, a confirmation is asked to the user.
You may bypass it by passing
.B --yes
on the command line.

If the rename format uses a field that is not defined,
a warning is shown and confirmation is always asked.

Available behaviors when renaming are:
.TP
.B y
Rename current file with current new filename.
This is the default.
.TP
.B a
Rename current file with current new filename.
Then, never asking for a renaming confirmation anymore.
.TP
.B e
Edit current new filename before renaming.
The behavior depends on the installed readline library.
If it is smart, the current value may be edited inline
and an history is available.
.TP
.B q
Don't rename current file.
.TP
.B h
Show help about confirmation.




.SH FORMAT
User-specified formats must be a string composed of any characters
and the following special codes:
.RS

.I "%a"
to match the author.

.I "%A"
to match the album.

.I "%g"
to match the genre.

.I "%n"
to match the track number.

.I "%t"
to match the title.

.I "%d"
to match the date.

.I "%c"
to match the comment.

.I "%i"
to match anything and ignore it.

.I "%%"
to match %.

Additionaly, while renaming, the following codes are available:
.RS

.I "%F"
is replaced by the original basename of the file.

.I "%E"
is replaced by the original extension of the file.

.I "%P"
is replaced by the original path of the file.



.SH INTERNAL FORMATS
The internal format database is usually stored in
.IR /etc/lltag/formats .
The user may override this file by defining a
.IR $HOME/.lltag/formats .
If this file exists, the system-wide one is ignored.

These files contain entries composed of :

.RE
.I [%n - %a - %t]
.RS
A title between bracket
.RE
.I type = basename
.RS
The type is either
.I basename
or
.I path
.RE
.I regexp = %L%N%S-%S%A%S-%S%A%L
.RS
A format composed of %L for limiting space, %N for numbers, %S for a space,
%A for anything (except /), %P for any path and %% for %.
.RE
.I indices = n,a,t
.RS
A list of format letters corresponding to %N or %A field in the previous format
(See
.B FORMAT
for a list of these letters).




.SH CONFIGURATION FILES
lltag reads some configuration files before parsing command line options.
The system-wide configuration file is defined in
.I /etc/lltag/config
where all options are documented.

It also reads
.I $HOME/.lltag/config
if it exists.

The user may also add another configurable file with
.B --config .

lltag may also generate a configuration with
.B --gencfg .

The available options are :

.I format = \fI"string"
.RS
Add a user-defined format
.RB [ -R ].
Might be used multiple times.
Default is to guess if no user-defined formats and no default field values are given.
.RE
.I guess = <0/1>
.RS
Try to guess if user-defined formats do not match
.RB [ -G ].
Default is
.BR 0 " (" disabled ") when no user-defined formats and no default field values are given."
.RE
.I nopath = <0/1>
.RS
Do not use file path when matching filename
.RB [ -p ].
Default is
.BR 0 " (" disabled ")."
.RE
.I default_ARTIST = \fI"string"
.RE
.I default_TITLE = \fI"string"
.RE
.I default_ALBUM = \fI"string"
.RE
.I default_NUMBER = \fI"string"
.RE
.I default_GENRE = \fI"string"
.RE
.I default_DATE = \fI"string"
.RE
.I default_COMMENT = \fI"string"
.RS
Default field value
.RB [ -a ", " -t ", " -A ", " -n ", " -g ", " -d " and " -c ].
Default is to not set any default value.
.RE
.I tag = <TAG=value>
.RS
Add an additional tag
.RB [ --tag ].
Might be used multiple times.
.RE
.I spaces = <0/1>
.RS
Allow no or multiple spaces
.RB [ --spaces ].
Default is
.BR 0 " (" disabled ")."
.RE
.I maj = <0/1>
.RS
Upcase first letters of words in tags
.RB [ --maj ].
Default is
.BR 0 " (" disabled ")."
.RE
.I regexp = \fI"s/from/to/"
.RS
Replace \fIfrom\fR with \fIto\fR in all tags.
.I title,number:s/from/to/
replaces in title and number tags only.
Might be used multiple times
.RB [ --regexp ].
Default is to not apply any regexp.
.RE
.I sep = \fI"string"
.RS
Replace |-separated strings with space in tags.
Default is to not replace any separator.
.RE
.I type = <mp3|ogg|flac|none>
.RS
Force mp3, ogg of flac instead of by-extension detection
.RB [ --mp3 ", " --ogg " and " --flac ].
Default is
.BR none .
.RE
.I clear_tags = <0/1>
.RS
Clear all tags of audio files.
.BR [ --clear ].
Default is
.BR 0 " (" disabled ")."
.RE
.I append_tags = <0/1>
.RS
Append tags only instead of replacing old ones.
.RB [ --append ].
Default is
.BR 0 " (" disabled ")."
.RE
.I no_tagging = <0/1>
.RS
Do not actually tag files
.RB [ --no-tagging ].
Default is
.BR 0 " (" disabled ")."
.RE
.I rename_format = \fI"string"
.RS
Rename file according to format
.RB [ --rename ].
Default is to not rename.
.RE
.I rename_min = <0/1>
.RS
Lowcase tags before renaming
.RB [ --rename-min ].
Default is
.BR 0 " (" disabled ")."
.RE
.I rename_regexp = \fI"s/from/to/"
.RS
Replace \fIfrom\fR with \fIto\fR in all tags before renaming.
.I title,number:s/from/to/
replaces in title and number tags only.
Might be used multiple times
.RB [ --rename-regexp ].
Default is to not apply any regexp.
.RE
.I rename_sep = \fI"string"
.RS
Replace space with s in tags before renaming
.RB [ --rename-sep ].
Default is to not replace any separator.
.RE
.I rename_ext = <0/1>
.RS
Assume the rename format provides an extension
.RB [ --rename-ext ].
Default is
.BR 0 " (" disabled ")."
.RE
.I dry_run = <0/1>
.RS
Do nothing but show what would have been done
.RB [ --dry-run ].
Default is
.BR 0 " (" disabled ")."
.RE
.I yes = <0/1>
.RS
Tag without asking for confirmation when guessing
and rename without asking for confirmation
.RB [ --yes ].
Default is
.BR 0 " (" disabled ")."
.RE
.I ask = <0/1>
.RS
Always ask for confirmation before tagging
.RB [ --ask ].
Default is
.BR 0 " (" disabled ")."
.RE
.I recursive = <0/1>
.RS
Recursively traverse all given subdirectories
.RB [ -R ].
Default is
.BR 0 " (" disabled ")."
.RE
.I verbose = <0/1>
.RS
Verbose messages
.RB [ -v ].
Default is
.BR 0 " (" disabled ")."
.RE
.I cddb_server_name = "hostname"
.RS
Change the CDDB server name.
Default is
.BR www.freedb.org .
.RE
.I cddb_server_port = <port>
.RS
Change the CDDB server port.
Default is
.BR 80 " (" HTTP ")."
.RE




.SH FILES
.RE
.I /etc/lltag/formats
.RS
System-wide internal format database.
See
.B INTERNAL FORMATS
for details.
.RE
.I $HOME/.lltag/formats
.RS
User internal format database. If it exists, the system-wide one is ignored.
.RE
.I $HOME/.lltag/edit_history
.RS
History of last entered values in the edition mode if the
.B Readline
library supports this feature.
.RE
.I /etc/lltag/config
.RS
System-wide configuration file, with documentation.
See
.B CONFIGURATION FILES
for details.
.RE
.I $HOME/.lltag/config
.RS
User configuration file.




.SH AUTHOR
Brice Goglin
